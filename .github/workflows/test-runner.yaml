name: Test Runner

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-runner:
    name: Test GitHub Actions Runner
    runs-on: vollminlab
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Test basic commands
        run: |
          echo "ğŸš€ Testing GitHub Actions Runner on Kubernetes!"
          echo "Runner OS: $(uname -a)"
          echo "Available tools:"
          which kubectl || echo "kubectl not found"
          which helm || echo "helm not found"
          which flux || echo "flux not found"
          
      - name: Install kubectl
        run: |
          echo "ğŸ“¦ Installing kubectl..."
          curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
          chmod +x kubectl
          sudo mv kubectl /usr/local/bin/
          kubectl version --client

      - name: Test kubectl access
        run: |
          echo "ğŸ” Testing kubectl access..."
          kubectl get nodes
          kubectl get namespaces
          
      - name: Test cluster connectivity
        run: |
          echo "ğŸ” Testing cluster connectivity..."
          kubectl get pods -A --no-headers | wc -l
          echo "Total pods in cluster: $(kubectl get pods -A --no-headers | wc -l)"
          
      - name: Success
        run: |
          echo "âœ… Runner test completed successfully!"
          echo "ğŸ‰ Your GitHub Actions Runner is working!"