apiVersion: v1
kind: ConfigMap
metadata:
  name: minecraft-values
  namespace: dmz
  labels:
    app: minecraft
    env: production
    category: gaming
data:
  values.yaml: |
    image:
      repository: itzg/minecraft-server
      tag: "java21"
    resources:
      requests:
        cpu: 2000m
        memory: 6Gi
      limits:
        cpu: 4000m
        memory: 8Gi
    nodeSelector:
      kubernetes.io/hostname: k8sworker05
    tolerations:
      - key: "dmz"
        operator: "Equal"
        value: "true"
        effect: "NoSchedule"
    podLabels:
      app: minecraft
      env: production
      category: gaming
    persistence:
      dataDir:
        enabled: true
        Size: 20Gi
      storageClass: longhorn
    minecraftServer:
      eula: "TRUE"
      version: "1.21.10"
      type: "PAPER"
      memory: "6G"
      viewDistance: 8
      maxPlayers: 20
      difficulty: normal
      serviceType: NodePort
      nodePort: 32565
      externalTrafficPolicy: Local
      # maxWorldSize: Not directly supported by Helm chart - use MAX_WORLD_SIZE env var instead
      rcon:
        enabled: true
        # Password is now stored in SealedSecret and passed via environment variable
    extraEnv:
      SIMULATION_DISTANCE: "6"
      PLUGINS: "https://cdn.modrinth.com/data/swbUV1cr/versions/lfk408pd/bluemap-5.13-spigot.jar"
      # Set max-world-size to default (29999984) - controls world generation, NOT the playable border
      # The world border is controlled via /worldborder command
      MAX_WORLD_SIZE: "29999984"
    # RCON password from secret (itzg/minecraft-server supports RCON_PASSWORD env var)
    # Note: The Helm chart may need extraEnvVars or envFrom instead - check chart docs
    extraEnvVars:
      - name: RCON_PASSWORD
        valueFrom:
          secretKeyRef:
            name: minecraft-rcon-secret
            key: password
    readinessProbe:
      initialDelaySeconds: 30
      periodSeconds: 10
      failureThreshold: 10
      successThreshold: 1
      timeoutSeconds: 1
    livenessProbe:
      initialDelaySeconds: 30
      periodSeconds: 5
      failureThreshold: 10
      successThreshold: 1
      timeoutSeconds: 1
